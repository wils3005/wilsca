parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"vHo1":[function(require,module,exports) {
var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),module.exports.binaryFeatures=e;var r=module.exports.BlobBuilder;function t(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(r=module.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),t.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},t.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);e.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},t.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var t=new r,i=0,u=this._parts.length;i<u;i++)t.append(this._parts[i]);return t.getBlob()}return new Blob(this._parts)},module.exports.BufferBuilder=t;
},{}],"lHOc":[function(require,module,exports) {
var t=require("./bufferbuilder").BufferBuilder,e=require("./bufferbuilder").binaryFeatures,i={unpack:function(t){return new r(t).unpack()},pack:function(t){var e=new n;return e.pack(t),e.getBuffer()}};function r(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function n(){this.bufferBuilder=new t}function u(t){var e=t.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function a(t){return t.length>600?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,u).length}module.exports=i,r.prototype.unpack=function(){var t,e=this.unpack_uint8();if(e<128)return e;if((224^e)<32)return(224^e)-32;if((t=160^e)<=15)return this.unpack_raw(t);if((t=176^e)<=15)return this.unpack_string(t);if((t=144^e)<=15)return this.unpack_array(t);if((t=128^e)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}},r.prototype.unpack_uint8=function(){var t=255&this.dataView[this.index];return this.index++,t},r.prototype.unpack_uint16=function(){var t=this.read(2),e=256*(255&t[0])+(255&t[1]);return this.index+=2,e},r.prototype.unpack_uint32=function(){var t=this.read(4),e=256*(256*(256*t[0]+t[1])+t[2])+t[3];return this.index+=4,e},r.prototype.unpack_uint64=function(){var t=this.read(8),e=256*(256*(256*(256*(256*(256*(256*t[0]+t[1])+t[2])+t[3])+t[4])+t[5])+t[6])+t[7];return this.index+=8,e},r.prototype.unpack_int8=function(){var t=this.unpack_uint8();return t<128?t:t-256},r.prototype.unpack_int16=function(){var t=this.unpack_uint16();return t<32768?t:t-65536},r.prototype.unpack_int32=function(){var t=this.unpack_uint32();return t<Math.pow(2,31)?t:t-Math.pow(2,32)},r.prototype.unpack_int64=function(){var t=this.unpack_uint64();return t<Math.pow(2,63)?t:t-Math.pow(2,64)},r.prototype.unpack_raw=function(t){if(this.length<this.index+t)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+t+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e},r.prototype.unpack_string=function(t){for(var e,i,r=this.read(t),n=0,u="";n<t;)(e=r[n])<128?(u+=String.fromCharCode(e),n++):(192^e)<32?(i=(192^e)<<6|63&r[n+1],u+=String.fromCharCode(i),n+=2):(i=(15&e)<<12|(63&r[n+1])<<6|63&r[n+2],u+=String.fromCharCode(i),n+=3);return this.index+=t,u},r.prototype.unpack_array=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.unpack();return e},r.prototype.unpack_map=function(t){for(var e={},i=0;i<t;i++){var r=this.unpack(),n=this.unpack();e[r]=n}return e},r.prototype.unpack_float=function(){var t=this.unpack_uint32(),e=(t>>23&255)-127;return(0==t>>31?1:-1)*(8388607&t|8388608)*Math.pow(2,e-23)},r.prototype.unpack_double=function(){var t=this.unpack_uint32(),e=this.unpack_uint32(),i=(t>>20&2047)-1023;return(0==t>>31?1:-1)*((1048575&t|1048576)*Math.pow(2,i-20)+e*Math.pow(2,i-52))},r.prototype.read=function(t){var e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")},n.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},n.prototype.pack=function(t){var i=typeof t;if("string"==i)this.pack_string(t);else if("number"==i)Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if("boolean"==i)!0===t?this.bufferBuilder.append(195):!1===t&&this.bufferBuilder.append(194);else if("undefined"==i)this.bufferBuilder.append(192);else{if("object"!=i)throw new Error('Type "'+i+'" not yet supported');if(null===t)this.bufferBuilder.append(192);else{var r=t.constructor;if(r==Array)this.pack_array(t);else if(r==Blob||r==File)this.pack_bin(t);else if(r==ArrayBuffer)e.useArrayBufferView?this.pack_bin(new Uint8Array(t)):this.pack_bin(t);else if("BYTES_PER_ELEMENT"in t)e.useArrayBufferView?this.pack_bin(new Uint8Array(t.buffer)):this.pack_bin(t.buffer);else if(r==Object)this.pack_object(t);else if(r==Date)this.pack_string(t.toString());else{if("function"!=typeof t.toBinaryPack)throw new Error('Type "'+r.toString()+'" not yet supported');this.bufferBuilder.append(t.toBinaryPack())}}}this.bufferBuilder.flush()},n.prototype.pack_bin=function(t){var e=t.length||t.byteLength||t.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(e)}this.bufferBuilder.append(t)},n.prototype.pack_string=function(t){var e=a(t);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(e)}this.bufferBuilder.append(t)},n.prototype.pack_array=function(t){var e=t.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(e)}for(var i=0;i<e;i++)this.pack(t[i])},n.prototype.pack_integer=function(t){if(-32<=t&&t<=127)this.bufferBuilder.append(255&t);else if(0<=t&&t<=255)this.bufferBuilder.append(204),this.pack_uint8(t);else if(-128<=t&&t<=127)this.bufferBuilder.append(208),this.pack_int8(t);else if(0<=t&&t<=65535)this.bufferBuilder.append(205),this.pack_uint16(t);else if(-32768<=t&&t<=32767)this.bufferBuilder.append(209),this.pack_int16(t);else if(0<=t&&t<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(t);else if(-2147483648<=t&&t<=2147483647)this.bufferBuilder.append(210),this.pack_int32(t);else if(-0x8000000000000000<=t&&t<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(t);else{if(!(0<=t&&t<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(t)}},n.prototype.pack_double=function(t){var e=0;t<0&&(e=1,t=-t);var i=Math.floor(Math.log(t)/Math.LN2),r=t/Math.pow(2,i)-1,n=Math.floor(r*Math.pow(2,52)),u=Math.pow(2,32),a=e<<31|i+1023<<20|n/u&1048575,p=n%u;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(p)},n.prototype.pack_object=function(t){var e=Object.keys(t).length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(e)}for(var i in t)t.hasOwnProperty(i)&&(this.pack(i),this.pack(t[i]))},n.prototype.pack_uint8=function(t){this.bufferBuilder.append(t)},n.prototype.pack_uint16=function(t){this.bufferBuilder.append(t>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_uint32=function(t){var e=4294967295&t;this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},n.prototype.pack_uint64=function(t){var e=t/Math.pow(2,32),i=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)},n.prototype.pack_int8=function(t){this.bufferBuilder.append(255&t)},n.prototype.pack_int16=function(t){this.bufferBuilder.append((65280&t)>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_int32=function(t){this.bufferBuilder.append(t>>>24&255),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_int64=function(t){var e=Math.floor(t/Math.pow(2,32)),i=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)};
},{"./bufferbuilder":"vHo1"}],"sXtV":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;
},{}],"BHXf":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.default=e,n};exports.__esModule=!0;var r,t=n(require("js-binarypack")),o=require("./adapter"),a={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};!function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(r=exports.DebugLevel||(exports.DebugLevel={}));var i=function(){function e(){}var n;return e.noop=function(){},e.setLogLevel=function(n){var t=parseInt(n,10);isNaN(parseInt(n,10))?e.logLevel=n?r.All:r.Disabled:e.logLevel=t,e.log=e.warn=e.error=e.noop,e.logLevel>r.Disabled&&(e.error=e._printWith("ERROR")),e.logLevel>r.Errors&&(e.warn=e._printWith("WARNING")),e.logLevel>r.Warnings&&(e.log=e._print)},e.setLogFunction=function(n){n.constructor!==Function?e.warn("The log function you passed in is not a function. Defaulting to regular logs."):e._print=n},e._printWith=function(n){return function(){var r=Array.prototype.slice.call(arguments);r.unshift(n),e._print.apply(e,r)}},e._print=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=!1,t=e.slice();for(var o in t.unshift("PeerJS: "),t)t[o]instanceof Error&&(t[o]="("+t[o].name+") "+t[o].message,r=!0);r?console.error.apply(console,t):console.log.apply(console,t)},e.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.inherits=function(e,n){e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},e.extend=function(e,n){for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);return e},e.log=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(e.debug){var t=!1,o=n.slice();for(var a in o.unshift("PeerJS: "),o)o[a]instanceof Error&&(o[a]="("+o[a].name+") "+o[a].message,t=!0);t?console.error.apply(console,o):console.log.apply(console,o)}},e.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n]},e.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n]},e.chunk=function(n){for(var r,t=[],o=n.size,a=Math.ceil(o/e.chunkedMTU),i=r=0;i<o;){var l=Math.min(o,i+e.chunkedMTU),s=n.slice(i,l),u={__peerData:this._dataCount,n:r,data:s,total:a};t.push(u),i=l,r++}return this._dataCount++,t},e.blobToArrayBuffer=function(e,n){var r=new FileReader;r.onload=function(e){n(e.target.result)},r.readAsArrayBuffer(e)},e.blobToBinaryString=function(e,n){var r=new FileReader;r.onload=function(e){n(e.target.result)},r.readAsBinaryString(e)},e.binaryStringToArrayBuffer=function(e){for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=255&e.charCodeAt(r);return n.buffer},e.randomToken=function(){return Math.random().toString(36).substr(2)},e.isSecure=function(){return"https:"===location.protocol},e.CLOUD_HOST="0.peerjs.com",e.CLOUD_PORT=443,e.chunkedBrowsers={Chrome:1},e.chunkedMTU=16300,e.debug=!1,e.logLevel=r.Disabled,e.defaultConfig=a,e.browser=(n=window).mozRTCPeerConnection?"Firefox":n.webkitRTCPeerConnection?"Chrome":n.RTCPeerConnection?"Supported":"Unsupported",e.supports=function(){if(void 0===o.RTCPeerConnection)return{};var e,n,r=!0,t=!0,i=!1,l=!1,s=!!window.webkitRTCPeerConnection;try{e=new o.RTCPeerConnection(a,{optional:[{RtpDataChannels:!0}]})}catch(c){r=!1,t=!1}if(r)try{n=e.createDataChannel("_PEERJSTEST")}catch(c){r=!1}if(r){try{n.binaryType="blob",i=!0}catch(c){}var u=new o.RTCPeerConnection(a,{});try{l=u.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(c){}u.close()}return t&&(t=!!e.addStream),e&&e.close(),{audioVideo:t,data:r,binaryBlob:i,binary:l,reliable:l,sctp:l,onnegotiationneeded:s}}(),e.pack=t.pack,e.unpack=t.unpack,e.setZeroTimeout=function(e){var n=[],r="zero-timeout-message";function t(t){t.source===e&&t.data===r&&(t.stopPropagation&&t.stopPropagation(),n.length&&n.shift()())}return e.addEventListener?e.addEventListener("message",t,!0):e.attachEvent&&e.attachEvent("onmessage",t),function(t){n.push(t),e.postMessage(r,"*")}}(window),e._dataCount=1,e}();exports.util=i;
},{"js-binarypack":"lHOc","./adapter":"sXtV"}],"2JJl":[function(require,module,exports) {
"use strict";var e=Object.prototype.hasOwnProperty,t="~";function n(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,n,o,s,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var c=new r(o,s||e,i),f=t?t+n:n;return e._events[f]?e._events[f].fn?e._events[f]=[e._events[f],c]:e._events[f].push(c):(e._events[f]=c,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function i(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(t=!1)),i.prototype.eventNames=function(){var n,r,o=[];if(0===this._eventsCount)return o;for(r in n=this._events)e.call(n,r)&&o.push(t?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(n)):o},i.prototype.listeners=function(e){var n=t?t+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,i=new Array(s);o<s;o++)i[o]=r[o].fn;return i},i.prototype.listenerCount=function(e){var n=t?t+e:e,r=this._events[n];return r?r.fn?1:r.length:0},i.prototype.emit=function(e,n,r,o,s,i){var c=t?t+e:e;if(!this._events[c])return!1;var f,u,a=this._events[c],l=arguments.length;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),l){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,n),!0;case 3:return a.fn.call(a.context,n,r),!0;case 4:return a.fn.call(a.context,n,r,o),!0;case 5:return a.fn.call(a.context,n,r,o,s),!0;case 6:return a.fn.call(a.context,n,r,o,s,i),!0}for(u=1,f=new Array(l-1);u<l;u++)f[u-1]=arguments[u];a.fn.apply(a.context,f)}else{var v,h=a.length;for(u=0;u<h;u++)switch(a[u].once&&this.removeListener(e,a[u].fn,void 0,!0),l){case 1:a[u].fn.call(a[u].context);break;case 2:a[u].fn.call(a[u].context,n);break;case 3:a[u].fn.call(a[u].context,n,r);break;case 4:a[u].fn.call(a[u].context,n,r,o);break;default:if(!f)for(v=1,f=new Array(l-1);v<l;v++)f[v-1]=arguments[v];a[u].fn.apply(a[u].context,f)}}return!0},i.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},i.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},i.prototype.removeListener=function(e,n,r,o){var i=t?t+e:e;if(!this._events[i])return this;if(!n)return s(this,i),this;var c=this._events[i];if(c.fn)c.fn!==n||o&&!c.once||r&&c.context!==r||s(this,i);else{for(var f=0,u=[],a=c.length;f<a;f++)(c[f].fn!==n||o&&!c[f].once||r&&c[f].context!==r)&&u.push(c[f]);u.length?this._events[i]=1===u.length?u[0]:u:s(this,i)}return this},i.prototype.removeAllListeners=function(e){var r;return e?(r=t?t+e:e,this._events[r]&&s(this,r)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=t,i.EventEmitter=i,"undefined"!=typeof module&&(module.exports=i);
},{}],"9ZRY":[function(require,module,exports) {
"use strict";var e,r,o,n,t,a;exports.__esModule=!0,function(e){e.Open="open",e.Stream="stream",e.Data="data",e.Close="close",e.Error="error"}(e=exports.ConnectionEventType||(exports.ConnectionEventType={})),function(e){e.Data="data",e.Media="media"}(r=exports.ConnectionType||(exports.ConnectionType={})),function(e){e.Open="open",e.Close="close",e.Connection="connection",e.Call="call",e.Disconnected="disconnected",e.Error="error"}(o=exports.PeerEventType||(exports.PeerEventType={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}(n=exports.PeerErrorType||(exports.PeerErrorType={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(t=exports.SerializationType||(exports.SerializationType={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(a=exports.SocketEventType||(exports.SocketEventType={}));
},{}],"wJlv":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();exports.__esModule=!0;var e=require("./util"),s=require("eventemitter3"),n=require("./enums"),o=function(){function t(t,e){this.streamIndex=t,this._httpUrl=e,this.index=1,this.buffer=[],this._xmlHttpRequest=new XMLHttpRequest,this._onError=function(t){},this._onSuccess=function(t){};var s=this;this._xmlHttpRequest.onerror=function(){s._onError(s)},this._xmlHttpRequest.onreadystatechange=function(){s.needsClearPreviousRequest()?s.clearPreviousRequest():s.isSuccess()&&s._onSuccess(s)}}return Object.defineProperty(t.prototype,"onError",{set:function(t){this._onError=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSuccess",{set:function(t){this._onSuccess=t},enumerable:!0,configurable:!0}),t.prototype.send=function(){this._xmlHttpRequest.open("post",this._httpUrl+"/id?i="+this.streamIndex,!0),this._xmlHttpRequest.send(null)},t.prototype.abort=function(){this._xmlHttpRequest.abort(),this._xmlHttpRequest=null},t.prototype.isSuccess=function(){return this._xmlHttpRequest.readyState>2&&200===this._xmlHttpRequest.status&&!!this._xmlHttpRequest.responseText},t.prototype.needsClearPreviousRequest=function(){return 2===this._xmlHttpRequest.readyState&&!!this.previousRequest},t.prototype.clearPreviousRequest=function(){this.previousRequest&&(this.previousRequest.abort(),this.previousRequest=null)},t.prototype.getMessages=function(){return this._xmlHttpRequest.responseText.split("\n")},t.prototype.hasBufferedIndices=function(){return this.buffer.length>0},t.prototype.popBufferedIndex=function(){return this.buffer.shift()},t.prototype.pushIndexToBuffer=function(t){this.buffer.push(t)},t}(),i=function(s){function i(t,e,n,o,i,r){void 0===r&&(r=n);var u=s.call(this)||this;u.HTTP_TIMEOUT=25e3,u.WEB_SOCKET_PING_INTERVAL=2e4,u._disconnected=!1,u._messagesQueue=[];var c=t?"https://":"http://",p=t?"wss://":"ws://";return u._httpUrl=c+e+":"+n+o+i,u._wsUrl=p+e+":"+r+o+"peerjs?key="+i,u}return t(i,s),i.prototype.start=function(t,e){this._id=t,this._httpUrl+="/"+t+"/"+e,this._wsUrl+="&id="+t+"&token="+e,this._startXhrStream(),this._startWebSocket()},i.prototype._startWebSocket=function(){if(!this._socket){this._socket=new WebSocket(this._wsUrl);var t=this;this._socket.onmessage=function(s){var o;try{o=JSON.parse(s.data)}catch(i){return void e.util.log("Invalid server message",s.data)}t.emit(n.SocketEventType.Message,o)},this._socket.onclose=function(s){e.util.log("Socket closed.",s),t._disconnected=!0,t.emit(n.SocketEventType.Disconnected)},this._socket.onopen=function(){t._timeout&&(clearTimeout(t._timeout),setTimeout(function(){t._httpRequest.abort(),t._httpRequest=null},5e3)),t._sendQueuedMessages(),e.util.log("Socket open"),t._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},t.WEB_SOCKET_PING_INTERVAL)}}},i.prototype._startXhrStream=function(t){var s=this;void 0===t&&(t=0);var i=new o(t,this._httpUrl);this._httpRequest=i,i.onError=function(){clearTimeout(s._timeout),s.emit(n.SocketEventType.Disconnected)},i.onSuccess=function(){s._handleStream(i)};try{i.send(),this._setHTTPTimeout()}catch(r){e.util.log("XMLHttpRequest not available; defaulting to WebSockets")}},i.prototype._sendHeartbeat=function(){if(this._wsOpen()){var t=JSON.stringify({type:"HEARTBEAT"});this._socket.send(t);var s=this;this._wsPingTimer=setTimeout(function(){s._sendHeartbeat()},this.WEB_SOCKET_PING_INTERVAL)}else e.util.log("Cannot send heartbeat, because socket closed")},i.prototype._handleStream=function(t){for(var s=t.getMessages();t.hasBufferedIndices();){var o=t.popBufferedIndex(),i=s[o];try{i=JSON.parse(i)}catch(u){t.buffer.unshift(o);break}this.emit(n.SocketEventType.Message,i)}var r=s[t.index];if(r)if(t.index+=1,t.index===s.length)t.pushIndexToBuffer(t.index-1);else{try{r=JSON.parse(r)}catch(u){return void e.util.log("Invalid server message",r)}this.emit(n.SocketEventType.Message,r)}},i.prototype._setHTTPTimeout=function(){var t=this;this._timeout=setTimeout(function(){if(t._wsOpen())t._httpRequest.abort(),t._httpRequest=null;else{var e=t._httpRequest;t._startXhrStream(e.streamIndex+1),t._httpRequest.previousRequest=e}},this.HTTP_TIMEOUT)},i.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},i.prototype._sendQueuedMessages=function(){var t=this._messagesQueue.slice();this._messagesQueue=[];for(var e=0,s=t;e<s.length;e++){var n=s[e];this.send(n)}},i.prototype.send=function(t){if(!this._disconnected)if(this._id)if(t.type){var e=JSON.stringify(t);if(this._wsOpen())this._socket.send(e);else{var s=new XMLHttpRequest,o=this._httpUrl+"/"+t.type.toLowerCase();s.open("post",o,!0),s.setRequestHeader("Content-Type","application/json"),s.send(e)}}else this.emit(n.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(t)},i.prototype.close=function(){!this._disconnected&&this._wsOpen()&&(this._socket.close(),this._disconnected=!0,clearTimeout(this._wsPingTimer))},i}(s.EventEmitter);exports.Socket=i;
},{"./util":"BHXf","eventemitter3":"2JJl","./enums":"9ZRY"}],"T9kO":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],r=require("js-binarypack"),t={debug:!1,inherits:function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e},pack:r.pack,unpack:r.unpack,log:function(){if(t.debug){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:function(e){var r=[],t="zero-timeout-message";function n(n){n.source==e&&n.data==t&&(n.stopPropagation&&n.stopPropagation(),r.length&&r.shift()())}return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),function(n){r.push(n),e.postMessage(t,"*")}}(this),blobToArrayBuffer:function(e,r){var t=new FileReader;t.onload=function(e){r(e.target.result)},t.readAsArrayBuffer(e)},blobToBinaryString:function(e,r){var t=new FileReader;t.onload=function(e){r(e.target.result)},t.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=255&e.charCodeAt(t);return r.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};module.exports=t;
},{"js-binarypack":"lHOc"}],"aYFJ":[function(require,module,exports) {
var t=require("./util");function e(n,i){if(!(this instanceof e))return new e(n);this._dc=n,t.debug=i,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}e.prototype.send=function(e){var n=t.pack(e);n.size<this._mtu?this._handleSend(["no",n]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(n)},t.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},e.prototype._setupInterval=function(){var t=this;this._timeout=setInterval(function(){var e=t._queue.shift();if(e._multiple)for(var n=0,i=e.length;n<i;n+=1)t._intervalSend(e[n]);else t._intervalSend(e)},this._interval)},e.prototype._intervalSend=function(e){var n=this;e=t.pack(e),t.blobToBinaryString(e,function(t){n._dc.send(t)}),0===n._queue.length&&(clearTimeout(n._timeout),n._timeout=null)},e.prototype._processAcks=function(){for(var t in this._outgoing)this._outgoing.hasOwnProperty(t)&&this._sendWindowedChunks(t)},e.prototype._handleSend=function(t){for(var e=!0,n=0,i=this._queue.length;n<i;n+=1){var o=this._queue[n];o===t?e=!1:o._multiple&&-1!==o.indexOf(t)&&(e=!1)}e&&(this._queue.push(t),this._timeout||this._setupInterval())},e.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(n){var i=n.data;if(i.constructor===String){var o=t.binaryStringToArrayBuffer(i);i=t.unpack(o),e._handleMessage(i)}}},e.prototype._handleMessage=function(e){var n,i=e[1],o=this._incoming[i],s=this._outgoing[i];switch(e[0]){case"no":var a=i;a&&this.onmessage(t.unpack(a));break;case"end":if(n=o,this._received[i]=e[2],!n)break;this._ack(i);break;case"ack":if(n=s){var h=e[2];n.ack=Math.max(h,n.ack),n.ack>=n.chunks.length?(t.log("Time: ",new Date-n.timer),delete this._outgoing[i]):this._processAcks()}break;case"chunk":if(!(n=o)){if(!0===this._received[i])break;n={ack:["ack",i,0],chunks:[]},this._incoming[i]=n}var r=e[2],u=e[3];n.chunks[r]=new Uint8Array(u),r===n.ack[2]&&this._calculateNextAck(i),this._ack(i);break;default:this._handleSend(e)}},e.prototype._chunk=function(e){for(var n=[],i=e.size,o=0;o<i;){var s=Math.min(i,o+this._mtu),a={payload:e.slice(o,s)};n.push(a),o=s}return t.log("Created",n.length,"chunks."),n},e.prototype._ack=function(t){var e=this._incoming[t].ack;this._received[t]===e[2]&&(this._complete(t),this._received[t]=!0),this._handleSend(e)},e.prototype._calculateNextAck=function(t){for(var e=this._incoming[t],n=e.chunks,i=0,o=n.length;i<o;i+=1)if(void 0===n[i])return void(e.ack[2]=i);e.ack[2]=n.length},e.prototype._sendWindowedChunks=function(e){t.log("sendWindowedChunks for: ",e);for(var n=this._outgoing[e],i=n.chunks,o=[],s=Math.min(n.ack+this._window,i.length),a=n.ack;a<s;a+=1)i[a].sent&&a!==n.ack||(i[a].sent=!0,o.push(["chunk",e,a,i[a].payload]));n.ack+this._window>=i.length&&o.push(["end",e,i.length]),o._multiple=!0,this._handleSend(o)},e.prototype._complete=function(e){t.log("Completed called for",e);var n=this,i=this._incoming[e].chunks,o=new Blob(i);t.blobToArrayBuffer(o,function(e){n.onmessage(t.unpack(e))}),delete this._incoming[e]},e.higherBandwidthSDP=function(t){var e=navigator.appVersion.match(/Chrome\/(.*?) /);if(e&&(e=parseInt(e[1].split(".").shift()))<31){var n=t.split("b=AS:30");if(n.length>1)return n[0]+"b=AS:102400"+n[1]}return t},e.prototype.onmessage=function(t){},module.exports=e;
},{"./util":"T9kO"}],"HCdX":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},t=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,c)}s((r=r.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};exports.__esModule=!0;var o=require("./util"),i=require("./adapter"),a=r(require("reliable")),c=require("./enums"),s=function(){function r(){this.pcs={data:{},media:{}},this.queue=[],this._idPrefix="pc_"}return r.prototype.startConnection=function(e,t){var n=this._getPeerConnection(e,t);if(e.peerConnection=n,e.type===c.ConnectionType.Media&&t._stream&&this._addTracksToConnection(t._stream,n),t.originator){if(e.type===c.ConnectionType.Data){var r=e,i={};o.util.supports.sctp||(i={reliable:t.reliable});var a=n.createDataChannel(r.label,i);r.initialize(a)}this._makeOffer(e)}else this.handleSDP("OFFER",e,t.sdp)},r.prototype._getPeerConnection=function(e,t){this.pcs[e.type]||o.util.error(e.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),this.pcs[e.type][e.peer]||(this.pcs[e.type][e.peer]={});var n,r=this.pcs[e.type][e.peer];return t.pc&&(n=r[t.pc]),n&&"stable"===n.signalingState||(n=this._startPeerConnection(e)),n},r.prototype._startPeerConnection=function(e){o.util.log("Creating RTCPeerConnection.");var t=this._idPrefix+o.util.randomToken(),n={};e.type!==c.ConnectionType.Data||o.util.supports.sctp?e.type===c.ConnectionType.Media&&(n={optional:[{DtlsSrtpKeyAgreement:!0}]}):n={optional:[{RtpDataChannels:!0}]};var r=new i.RTCPeerConnection(e.provider.options.config,n);return this.pcs[e.type][e.peer][t]=r,this._setupListeners(e,r),r},r.prototype._setupListeners=function(e,t){var n=e.peer,r=e.connectionId,i=e.type,a=e.provider;o.util.log("Listening for ICE candidates."),t.onicecandidate=function(e){e.candidate&&(o.util.log("Received ICE candidates for:",n),a.socket.send({type:"CANDIDATE",payload:{candidate:e.candidate,type:i,connectionId:r},dst:n}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":o.util.log("iceConnectionState is disconnected, closing connections to "+n),e.emit(c.ConnectionEventType.Error,new Error("Negotiation of connection to "+n+" failed.")),e.close();break;case"disconnected":o.util.log("iceConnectionState is disconnected, closing connections to "+n);break;case"completed":t.onicecandidate=o.util.noop}},t.onicechange=t.oniceconnectionstatechange,o.util.log("Listening for data channel"),t.ondatachannel=function(e){o.util.log("Received data channel");var t=e.channel;a.getConnection(n,r).initialize(t)},o.util.log("Listening for remote stream");var s=this;t.ontrack=function(e){o.util.log("Received remote stream");var t=e.streams[0],i=a.getConnection(n,r);if(i.type===c.ConnectionType.Media){var l=i;s._addStreamToMediaConnection(t,l)}}},r.prototype.cleanup=function(e){o.util.log("Cleaning up PeerConnection to "+e.peer);var t=e.peerConnection;if(t){var n="closed"!==t.signalingState,r=!1;if(e.type===c.ConnectionType.Data){var i=e.dataChannel;r=i.readyState&&"closed"!==i.readyState}(n||r)&&(t.close(),e.peerConnection=null)}},r.prototype._makeOffer=function(r){return t(this,void 0,Promise,function(){var t,i,s,l,p,u;return n(this,function(n){switch(n.label){case 0:t=r.peerConnection,n.label=1;case 1:return n.trys.push([1,7,,8]),[4,t.createOffer(r.options.constraints)];case 2:i=n.sent(),o.util.log("Created offer."),o.util.supports.sctp||r.type!==c.ConnectionType.Data||(l=r).reliable&&(i.sdp=a.higherBandwidthSDP(i.sdp)),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,t.setLocalDescription(i)];case 4:return n.sent(),o.util.log("Set localDescription:",i,"for:"+r.peer),s={sdp:i,type:r.type,connectionId:r.connectionId,metadata:r.metadata,browser:o.util.browser},r.type===c.ConnectionType.Data&&(s=e({},s,{label:(l=r).label,reliable:l.reliable,serialization:l.serialization})),r.provider.socket.send({type:"OFFER",payload:s,dst:r.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(p=n.sent())&&(r.provider.emitError(c.PeerErrorType.WebRTC,p),o.util.log("Failed to setLocalDescription, ",p)),[3,6];case 6:return[3,8];case 7:return u=n.sent(),r.provider.emitError(c.PeerErrorType.WebRTC,u),o.util.log("Failed to createOffer, ",u),[3,8];case 8:return[2]}})})},r.prototype._makeAnswer=function(e){return t(this,void 0,Promise,function(){var t,r,i,s;return n(this,function(n){switch(n.label){case 0:t=e.peerConnection,n.label=1;case 1:return n.trys.push([1,7,,8]),[4,t.createAnswer()];case 2:r=n.sent(),o.util.log("Created answer."),o.util.supports.sctp||e.type!==c.ConnectionType.Data||e.reliable&&(r.sdp=a.higherBandwidthSDP(r.sdp)),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,t.setLocalDescription(r)];case 4:return n.sent(),o.util.log("Set localDescription:",r,"for:"+e.peer),e.provider.socket.send({type:"ANSWER",payload:{sdp:r,type:e.type,connectionId:e.connectionId,browser:o.util.browser},dst:e.peer}),[3,6];case 5:return i=n.sent(),e.provider.emitError(c.PeerErrorType.WebRTC,i),o.util.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return s=n.sent(),e.provider.emitError(c.PeerErrorType.WebRTC,s),o.util.log("Failed to create answer, ",s),[3,8];case 8:return[2]}})})},r.prototype.handleSDP=function(e,r,a){return t(this,void 0,Promise,function(){var t,s,l;return n(this,function(n){switch(n.label){case 0:a=new i.RTCSessionDescription(a),t=r.peerConnection,o.util.log("Setting remote description",a),s=this,n.label=1;case 1:return n.trys.push([1,5,,6]),[4,t.setRemoteDescription(a)];case 2:return n.sent(),o.util.log("Set remoteDescription:"+e+" for:"+r.peer),"OFFER"!==e?[3,4]:[4,s._makeAnswer(r)];case 3:n.sent(),n.label=4;case 4:return[3,6];case 5:return l=n.sent(),r.provider.emitError(c.PeerErrorType.WebRTC,l),o.util.log("Failed to setRemoteDescription, ",l),[3,6];case 6:return[2]}})})},r.prototype.handleCandidate=function(e,r){return t(this,void 0,Promise,function(){var t,a,s;return n(this,function(n){switch(n.label){case 0:t=r.candidate,a=r.sdpMLineIndex,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.peerConnection.addIceCandidate(new i.RTCIceCandidate({sdpMLineIndex:a,candidate:t}))];case 2:return n.sent(),o.util.log("Added ICE candidate for:"+e.peer),[3,4];case 3:return s=n.sent(),e.provider.emitError(c.PeerErrorType.WebRTC,s),o.util.log("Failed to handleCandidate, ",s),[3,4];case 4:return[2]}})})},r.prototype._addTracksToConnection=function(e,t){if(o.util.log("add tracks from stream "+e.id+" to peer connection"),!t.addTrack)return o.util.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(n){t.addTrack(n,e)})},r.prototype._addStreamToMediaConnection=function(e,t){o.util.log("add stream "+e.id+" to media connection "+t.connectionId),t.addStream(e)},r}();exports.default=new s;
},{"./util":"BHXf","./adapter":"sXtV","reliable":"aYFJ","./enums":"9ZRY"}],"tQFK":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();exports.__esModule=!0;var e=require("eventemitter3"),n=function(e){function n(t,n,o){var r=e.call(this)||this;return r.peer=t,r.provider=n,r.options=o,r._open=!1,r.metadata=o.metadata,r.connectionId=o.connectionId,r}return t(n,e),Object.defineProperty(n.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),n}(e.EventEmitter);exports.BaseConnection=n;
},{"eventemitter3":"2JJl"}],"dbHP":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var n=require("./util"),o=e(require("./negotiator")),r=require("./enums"),i=require("./baseconnection"),a=function(e){function i(t,r,a){var s=e.call(this,t,r,a)||this;return s.localStream=s.options._stream,s.connectionId=s.options.connectionId||i.ID_PREFIX+n.util.randomToken(),s.localStream&&o.default.startConnection(s,{_stream:s.localStream,originator:!0}),s}return t(i,e),Object.defineProperty(i.prototype,"type",{get:function(){return r.ConnectionType.Media},enumerable:!0,configurable:!0}),i.prototype.addStream=function(t){n.util.log("Receiving stream",t),this.remoteStream=t,e.prototype.emit.call(this,r.ConnectionEventType.Stream,t)},i.prototype.handleMessage=function(t){var e=t.type,r=t.payload;switch(t.type){case"ANSWER":o.default.handleSDP(e,this,r.sdp),this._open=!0;break;case"CANDIDATE":o.default.handleCandidate(this,r.candidate);break;default:n.util.warn("Unrecognized message type:"+e+" from peer:"+this.peer)}},i.prototype.answer=function(t){if(this.localStream)n.util.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this.options._payload._stream=t,this.localStream=t,o.default.startConnection(this,this.options._payload);for(var e=0,r=this.provider._getMessages(this.connectionId);e<r.length;e++){var i=r[e];this.handleMessage(i)}this._open=!0}},i.prototype.close=function(){this.open&&(this._open=!1,o.default.cleanup(this),e.prototype.emit.call(this,r.ConnectionEventType.Close))},i.ID_PREFIX="mc_",i}(i.BaseConnection);exports.MediaConnection=a;
},{"./util":"BHXf","./negotiator":"HCdX","./enums":"9ZRY","./baseconnection":"tQFK"}],"GBTQ":[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var n=require("./util"),i=t(require("./negotiator")),r=require("reliable"),a=require("./enums"),o=require("./baseconnection"),s=function(t){function o(e,r,a){var s=t.call(this,e,r,a)||this;return s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s.connectionId=a.connectionId||o.ID_PREFIX+n.util.randomToken(),s.label=a.label||s.connectionId,s.serialization=a.serialization,s.reliable=a.reliable,a._payload&&(s._peerBrowser=a._payload.browser),i.default.startConnection(s,a._payload||{originator:!0}),s}return e(o,t),Object.defineProperty(o.prototype,"type",{get:function(){return a.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),o.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},o.prototype._configureDataChannel=function(){n.util.supports.sctp&&(this.dataChannel.binaryType="arraybuffer");var e=this;this.dataChannel.onopen=function(){n.util.log("Data channel connection success"),e._open=!0,e.emit(a.ConnectionEventType.Open)},!n.util.supports.sctp&&this.reliable&&(this._reliable=new r.Reliable(this.dataChannel,n.util.debug)),this._reliable?this._reliable.onmessage=function(t){e.emit(a.ConnectionEventType.Data,t)}:this.dataChannel.onmessage=function(t){e._handleDataMessage(t)},this.dataChannel.onclose=function(t){n.util.log("DataChannel closed for:",e.peer),e.close()}},o.prototype._handleDataMessage=function(e){var i=e.data,r=i.constructor;if(this.serialization===a.SerializationType.Binary||this.serialization===a.SerializationType.BinaryUTF8){if(r===Blob){var o=this;return void n.util.blobToArrayBuffer(i,function(e){i=n.util.unpack(e),o.emit(a.ConnectionEventType.Data,i)})}if(r===ArrayBuffer)i=n.util.unpack(i);else if(r===String){var s=n.util.binaryStringToArrayBuffer(i);i=n.util.unpack(s)}}else this.serialization===a.SerializationType.JSON&&(i=JSON.parse(i));if(i.__peerData){var u=i.__peerData,l=this._chunkedData[u]||{data:[],count:0,total:i.total};return l.data[i.n]=i.data,l.count++,l.total===l.count&&(delete this._chunkedData[u],i=new Blob(l.data),this._handleDataMessage({data:i})),void(this._chunkedData[u]=l)}t.prototype.emit.call(this,a.ConnectionEventType.Data,i)},o.prototype.close=function(){this.open&&(this._open=!1,i.default.cleanup(this),t.prototype.emit.call(this,a.ConnectionEventType.Close))},o.prototype.send=function(e,i){if(this.open)if(this._reliable)this._reliable.send(e);else if(this.serialization===a.SerializationType.JSON)this._bufferedSend(JSON.stringify(e));else if(this.serialization===a.SerializationType.Binary||this.serialization===a.SerializationType.BinaryUTF8){var r=n.util.pack(e);if((n.util.chunkedBrowsers[this._peerBrowser]||n.util.chunkedBrowsers[n.util.browser])&&!i&&r.size>n.util.chunkedMTU)return void this._sendChunks(r);var o=this;n.util.supports.sctp?n.util.supports.binaryBlob?this._bufferedSend(r):n.util.blobToArrayBuffer(r,function(e){o._bufferedSend(e)}):n.util.blobToBinaryString(r,function(e){o._bufferedSend(e)})}else this._bufferedSend(e);else t.prototype.emit.call(this,a.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},o.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},o.prototype._trySend=function(e){try{this.dataChannel.send(e)}catch(n){this._buffering=!0;var t=this;return setTimeout(function(){t._buffering=!1,t._tryBuffer()},100),!1}return!0},o.prototype._tryBuffer=function(){if(0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},o.prototype._sendChunks=function(e){for(var t=0,i=n.util.chunk(e);t<i.length;t++){var r=i[t];this.send(r,!0)}},o.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=t.browser,i.default.handleSDP(e.type,this,t.sdp);break;case"CANDIDATE":i.default.handleCandidate(this,t.candidate);break;default:n.util.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},o.ID_PREFIX="dc_",o}(o.BaseConnection);exports.DataConnection=s;
},{"./util":"BHXf","./negotiator":"HCdX","reliable":"aYFJ","./enums":"9ZRY","./baseconnection":"tQFK"}],"in7L":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(n,s){function i(t){try{a(o.next(t))}catch(e){s(e)}}function u(t){try{a(o.throw(t))}catch(e){s(e)}}function a(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(i,u)}a((o=o.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var r,o,n,s,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(6===s[0]&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(u){s=[6,u],o=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};exports.__esModule=!0;var r=require("./util"),o=function(){function o(t){this._options=t}return o.prototype._buildUrl=function(t){var e=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+t;return e+="?ts="+(new Date).getTime()+Math.random()},o.prototype.retrieveId=function(){return t(this,void 0,Promise,function(){var t,o,n,s;return e(this,function(e){switch(e.label){case 0:t=this._buildUrl("id"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,fetch(t)];case 2:if(200!==(o=e.sent()).status)throw new Error("Error. Status:"+o.status);return[2,o.text()];case 3:throw n=e.sent(),r.util.error("Error retrieving ID",n),s="","/"===this._options.path&&this._options.host!==r.util.CLOUD_HOST&&(s=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+s);case 4:return[2]}})})},o.prototype.listAllPeers=function(){return t(this,void 0,Promise,function(){var t,o,n,s;return e(this,function(e){switch(e.label){case 0:t=this._buildUrl("peers"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,fetch(t)];case 2:if(200!==(o=e.sent()).status){if(401===o.status)throw n="",n=this._options.host===r.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n);throw new Error("Error. Status:"+o.status)}return[2,o.json()];case 3:throw s=e.sent(),r.util.error("Error retrieving list peers",s),new Error("Could not get list peers from the server."+s);case 4:return[2]}})})},o}();exports.API=o;
},{"./util":"BHXf"}],"Hxpd":[function(require,module,exports) {
"use strict";var e=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),t=this&&this.__assign||function(){return(t=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};exports.__esModule=!0;var n=require("./util"),o=require("eventemitter3"),r=require("./socket"),i=require("./mediaconnection"),s=require("./dataconnection"),c=require("./enums"),a=require("./api"),u=function(){return function(){}}(),d=function(o){function u(e,r){var i=o.call(this)||this;return i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map,e&&e.constructor==Object?(r=e,e=void 0):e&&(e=e.toString()),r=t({debug:0,host:n.util.CLOUD_HOST,port:n.util.CLOUD_PORT,path:"/",key:u.DEFAULT_KEY,token:n.util.randomToken(),config:n.util.defaultConfig},r),i._options=r,"/"===r.host&&(r.host=window.location.hostname),"/"!==r.path[0]&&(r.path="/"+r.path),"/"!==r.path[r.path.length-1]&&(r.path+="/"),void 0===r.secure&&r.host!==n.util.CLOUD_HOST?r.secure=n.util.isSecure():r.host==n.util.CLOUD_HOST&&(r.secure=!0),r.logFunction&&n.util.setLogFunction(r.logFunction),n.util.setLogLevel(String(r.debug)),n.util.supports.audioVideo||n.util.supports.data?n.util.validateId(e)?(i._api=new a.API(r),i._initializeServerConnection(),e?i._initialize(e):i._api.retrieveId().then(function(e){return i._initialize(e)}).catch(function(e){return i._abort(c.PeerErrorType.ServerError,e)}),i):(i._delayedAbort(c.PeerErrorType.InvalidID,'ID "'+e+'" is invalid'),i):(i._delayedAbort(c.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),i)}return e(u,o),Object.defineProperty(u.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"connections",{get:function(){return this._connections},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),u.prototype._initializeServerConnection=function(){this._socket=new r.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.wsport);var e=this;this.socket.on(c.SocketEventType.Message,function(t){e._handleMessage(t)}),this.socket.on(c.SocketEventType.Error,function(t){e._abort(c.PeerErrorType.SocketError,t)}),this.socket.on(c.SocketEventType.Disconnected,function(){e.disconnected||(e.emitError(c.PeerErrorType.Network,"Lost connection to server."),e.disconnect())}),this.socket.on(c.SocketEventType.Close,function(){e.disconnected||e._abort(c.PeerErrorType.SocketClosed,"Underlying socket is already closed.")})},u.prototype._initialize=function(e){this._id=e,this.socket.start(this.id,this._options.token)},u.prototype._handleMessage=function(e){var t=e.type,o=e.payload,r=e.src;switch(t){case"OPEN":this.emit(c.PeerEventType.Open,this.id),this._open=!0;break;case"ERROR":this._abort(c.PeerErrorType.ServerError,o.msg);break;case"ID-TAKEN":this._abort(c.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case"INVALID-KEY":this._abort(c.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case"LEAVE":n.util.log("Received leave message from",r),this._cleanupPeer(r);break;case"EXPIRE":this.emitError(c.PeerErrorType.PeerUnavailable,"Could not connect to peer "+r);break;case"OFFER":var a=o.connectionId;if((l=this.getConnection(r,a))&&(l.close(),n.util.warn("Offer received for existing Connection ID:",a)),o.type===c.ConnectionType.Media)l=new i.MediaConnection(r,this,{connectionId:a,_payload:o,metadata:o.metadata}),this._addConnection(r,l),this.emit(c.PeerEventType.Call,l);else{if(o.type!==c.ConnectionType.Data)return void n.util.warn("Received malformed connection type:",o.type);l=new s.DataConnection(r,this,{connectionId:a,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable}),this._addConnection(r,l),this.emit(c.PeerEventType.Connection,l)}for(var u=0,d=this._getMessages(a);u<d.length;u++){var p=d[u];l.handleMessage(p)}break;default:if(!o)return void n.util.warn("You received a malformed message from "+r+" of type "+t);var l;a=o.connectionId;(l=this.getConnection(r,a))&&l.peerConnection?l.handleMessage(e):a?this._storeMessage(a,e):n.util.warn("You received an unrecognized message:",e)}},u.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},u.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},u.prototype.connect=function(e,t){if(this.disconnected)return n.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(c.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var o=new s.DataConnection(e,this,t);return this._addConnection(e,o),o},u.prototype.call=function(e,t,o){if(void 0===o&&(o={}),this.disconnected)return n.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(c.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){o._stream=t;var r=new i.MediaConnection(e,this,o);return this._addConnection(e,r),r}n.util.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},u.prototype._addConnection=function(e,t){n.util.log("add connection "+t.type+":"+t.connectionId+"\n       to peerId:"+e),this.connections.has(e)||this.connections.set(e,[]),this.connections.get(e).push(t)},u.prototype.getConnection=function(e,t){var n=this.connections.get(e);if(!n)return null;for(var o=0,r=n;o<r.length;o++){var i=r[o];if(i.connectionId===t)return i}return null},u.prototype._delayedAbort=function(e,t){var o=this;n.util.setZeroTimeout(function(){o._abort(e,t)})},u.prototype._abort=function(e,t){n.util.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},u.prototype.emitError=function(e,t){n.util.error("Error:",t),"string"==typeof t&&(t=new Error(t)),t.type=e,this.emit(c.PeerEventType.Error,t)},u.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this._destroyed=!0)},u.prototype._cleanup=function(){for(var e=0,t=this.connections.keys();e<t.length;e++){var n=t[e];this._cleanupPeer(n),this.connections.delete(n)}this.emit(c.PeerEventType.Close)},u.prototype._cleanupPeer=function(e){var t=this.connections.get(e);if(t)for(var n=0,o=t;n<o.length;n++){o[n].close()}},u.prototype.disconnect=function(){var e=this;n.util.setZeroTimeout(function(){e.disconnected||(e._disconnected=!0,e._open=!1,e.socket&&e.socket.close(),e.emit(c.PeerEventType.Disconnected,e.id),e._lastServerId=e.id,e._id=null)})},u.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)n.util.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");n.util.error("In a hurry? We're still trying to make the initial connection!")}},u.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then(function(t){return e(t)}).catch(function(e){return t._abort(c.PeerErrorType.ServerError,e)})},u.DEFAULT_KEY="peerjs",u}(o.EventEmitter);exports.Peer=d;
},{"./util":"BHXf","eventemitter3":"2JJl","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"9ZRY","./api":"in7L"}],"iTK6":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var i=require("./util"),n=require("./adapter"),o=require("./socket"),t=require("./mediaconnection"),r=require("./dataconnection"),a=require("./peer"),d=e(require("./negotiator")),c=e(require("js-binarypack"));window.Socket=o.Socket,window.MediaConnection=t.MediaConnection,window.DataConnection=r.DataConnection,window.Peer=a.Peer,window.RTCPeerConnection=n.RTCPeerConnection,window.RTCSessionDescription=n.RTCSessionDescription,window.RTCIceCandidate=n.RTCIceCandidate,window.Negotiator=d.default,window.util=i.util,window.BinaryPack=c.default,exports.default=a.Peer;
},{"./util":"BHXf","./adapter":"sXtV","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./peer":"Hxpd","./negotiator":"HCdX","js-binarypack":"lHOc"}]},{},["iTK6"], null)
//# sourceMappingURL=/peerjs.min.js.map